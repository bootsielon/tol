//////////////////////////////////////////////////////////////////////////////
// FILE    : 
// PURPOSE :
//////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////
//    
//    
//             \   |     /
//              \  |    /
//               \ |   /
//                \|  /
//                 | /
//                 |/
//       ----------+-----------
//                 |
//    
//////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////
// Generic transformation case for V-Cost Functions
//////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////
  Real TransVDecision(Real nu, Real sigma, 
                      TransforStruct trans,
                      VCostStruct cost)
//////////////////////////////////////////////////////////////////////////////
{
  Code T  = trans->T;
  Code Ti = trans->InvT;
  Code dT = trans->DerT;
  Real DerCostNotNullJump(Real decision)
  {
    Real t  = T(decision, trans->TParam);
    Real Ft = DistNormal(t,nu,sigma);
    cost->PositiveCoef*Ft - cost->NegativeCoef*(1-Ft)
  };
  Real DerCostNullJump(Real decision)
  {
    Real t  = T(decision, trans->TParam);
    Real Ft = DistNormal(t,nu,sigma);
    Real dt = dT(decision, trans->TParam);
    Real ft = DensNormal(t,nu,sigma)*dt;
    cost->NullJump*ft + cost->PositiveCoef*Ft - cost->NegativeCoef*(1-Ft)
  };
  Code DerCost = If(cost->NullJump,DerCostNullJump,DerCostNotNullJump);
  Real Decision0 = Ti(nu,trans->TParam);
  Real Decision  = NewtonSolve(DerCost,Decision0);
  Decision
};


//////////////////////////////////////////////////////////////////////////////
// BOX-COX Transformation case
//////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////
  Real BoxCoxVDecision(Real         nu, 
                       Real         sigma, 
                       BoxCoxStruct boxcox,
                       VCostStruct  cost)
//////////////////////////////////////////////////////////////////////////////
{
  TransVDecision(nu, sigma, GetBoxCoxTrans(boxcox), cost)
};




